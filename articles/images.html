<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="tfevents">
<title>Writing images • tfevents</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Writing images">
<meta property="og:description" content="tfevents">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">tfevents</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.2.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <h6 class="dropdown-header" data-toc-skip>Guides</h6>
    <a class="dropdown-item" href="../articles/images.html">Writing images</a>
    <a class="dropdown-item" href="../articles/hparams.html">Hyperparameter tuning</a>
    <a class="dropdown-item" href="../articles/read.html">Reading event records</a>
    <div class="dropdown-divider"></div>
    <h6 class="dropdown-header" data-toc-skip>Examples</h6>
    <a class="dropdown-item" href="../articles/examples/torch.html">Logging torch runs</a>
  </div>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/mlverse/tfevents/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Writing images</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/mlverse/tfevents/blob/HEAD/vignettes/articles/images.Rmd" class="external-link"><code>vignettes/articles/images.Rmd</code></a></small>
      <div class="d-none name"><code>images.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mlverse/tfevents" class="external-link">tfevents</a></span><span class="op">)</span></span></code></pre></div>
<p>tfevents has the ability to write log images so they can be displayed
in the TensorBoard dashboard. This guide describes different ways you
can log images with tfevents and how to extend this functionality to
other kinds of R objects that you might want to log as images in the
dashboard.</p>
<div class="section level2">
<h2 id="from-arrays">From arrays<a class="anchor" aria-label="anchor" href="#from-arrays"></a>
</h2>
<p>The most common way to write images is when you have a batch of image
data in an R array. For example, suppose we want to write the first 5
training samples available in the Fashion MNIST dataset builtin into
Keras.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fashion_mnist</span> <span class="op">&lt;-</span> <span class="fu">keras</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/keras/man/dataset_fashion_mnist.html" class="external-link">dataset_fashion_mnist</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="va">train_imgs</span> <span class="op">&lt;-</span> <span class="va">fashion_mnist</span><span class="op">$</span><span class="va">train</span><span class="op">$</span><span class="va">x</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,,<span class="op">]</span><span class="op">/</span><span class="fl">255</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">train_imgs</span><span class="op">)</span></span>
<span><span class="co">#&gt;  num [1:5, 1:28, 1:28] 0 0 0 0 0 0 0 0 0 0 ...</span></span></code></pre></div>
<p>tfevents supports writing a batch of images from an array as long as
the array has 4 dimensions: <code>batch_size</code>,
<code>height</code>, <code>width</code> and <code>channels</code>. Thus
for the images in the Fashion MNIST dataset we need to add an extra
dimension denoting that those images have only one channel, ie. they are
grayscale images.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">train_imgs</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/dim.html" class="external-link">dim</a></span><span class="op">(</span><span class="va">train_imgs</span><span class="op">)</span>, <span class="fl">1</span><span class="op">)</span></span></code></pre></div>
<p>We can now log them to the default log directory (<code>logs</code>)
with:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/log_event.html">log_event</a></span><span class="op">(</span><span class="st">"Training samples"</span> <span class="op">=</span> <span class="fu"><a href="../reference/summary_image.html">summary_image</a></span><span class="op">(</span><span class="va">train_imgs</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>If we open the TensorBoard UI in the logdir we will see something
like the below:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tensorflow</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tensorflow/man/tensorboard.html" class="external-link">tensorboard</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/normalizePath.html" class="external-link">normalizePath</a></span><span class="op">(</span><span class="st">"logs"</span><span class="op">)</span>, port <span class="op">=</span> <span class="fl">6060</span><span class="op">)</span></span>
<span><span class="co">#&gt; Started TensorBoard at http://127.0.0.1:6060</span></span></code></pre></div>
<p>Notice that images are also associated to a global step counter. If
you save log images at multiple steps you will be able to visualize hwo
they change using the slider in TensorBoard.</p>
<p><img src="images_files/figure-html/batch-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="from-ggplot-objects">From ggplot objects<a class="anchor" aria-label="anchor" href="#from-ggplot-objects"></a>
</h2>
<p>You can also write images from ggplot2 plots, for example:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="va">p</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="va">mtcars</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">hp</span>, y <span class="op">=</span> <span class="va">mpg</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html" class="external-link">geom_point</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p>You can log plots using <code>log_event</code> and
<code>summary_image</code> and they will be displayed in TensorBoard.
The default size is 480x480 pixels but you can change the default by
passing <code>width</code> and <code>height</code> to
<code>summary_image</code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="st">"logdir"</span><span class="op">)</span> <span class="co"># use another logdir </span></span>
<span><span class="fu"><a href="../reference/get_default_logdir.html">set_default_logdir</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/log_event.html">log_event</a></span><span class="op">(</span><span class="st">"Ggplot2 plot"</span> <span class="op">=</span> <span class="fu"><a href="../reference/summary_image.html">summary_image</a></span><span class="op">(</span><span class="va">p</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>We now launch TensorBoard and see:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">tensorflow</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/tensorflow/man/tensorboard.html" class="external-link">tensorboard</a></span><span class="op">(</span><span class="va">temp</span>, port <span class="op">=</span> <span class="fl">6061</span><span class="op">)</span></span>
<span><span class="co">#&gt; Started TensorBoard at http://127.0.0.1:6061</span></span></code></pre></div>
<p><img src="images_files/figure-html/ggpl-1.png" width="100%"></p>
</div>
<div class="section level2">
<h2 id="extending">Extending<a class="anchor" aria-label="anchor" href="#extending"></a>
</h2>
<p>Currently those are the only two builtin supported objects for
writing images with tfevents. However we provide lower level interfaces
that allow you to extend support for your own data type.</p>
<p>The <code>summary_image</code> function is an S3 generic, so you can
implement it for your own type. For example, we could implement support
for logging a raster image by implementing a method for it. We also
provide methods for lower level representation of images, for example,
<code>summary_image.raw</code> can write a <code><a href="https://rdrr.io/r/base/raw.html" class="external-link">raw()</a></code> vector
containing a PNG encoded image.</p>
<p>Let’s implement a method for writing raster images, created with
<code><a href="https://rdrr.io/r/grDevices/as.raster.html" class="external-link">as.raster()</a></code>. For example, we can use the first image in the
Fashion MNIST dataset that we used earlier.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">img</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/as.raster.html" class="external-link">as.raster</a></span><span class="op">(</span><span class="va">train_imgs</span><span class="op">[</span><span class="fl">1</span>,,,<span class="op">]</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">img</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "raster"</span></span></code></pre></div>
<p>Now let’s define the <code>summary_image</code> method for the
<code>raster</code> class. We can get a PNG encoded image by saving it
to a file using <code><a href="https://rdrr.io/r/grDevices/png.html" class="external-link">grDevices::png</a></code> and then reading it back to
R.</p>
<p>Note that it’s important to have <code>metadata</code> and
<code>tag</code> arguments in the signature so your users can customize
hwo the image is displayed in TensorBoard.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">summary_image.raster</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">img</span>, <span class="va">...</span>, <span class="va">width</span> <span class="op">=</span> <span class="fl">480</span>, <span class="va">height</span> <span class="op">=</span> <span class="fl">480</span>, <span class="va">metadata</span> <span class="op">=</span> <span class="cn">NULL</span>, <span class="va">tag</span> <span class="op">=</span> <span class="cn">NA</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span>fileext <span class="op">=</span> <span class="st">".png"</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/on.exit.html" class="external-link">on.exit</a></span><span class="op">(</span><span class="op">{</span><span class="fu"><a href="https://rdrr.io/r/base/unlink.html" class="external-link">unlink</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span><span class="op">}</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu">grDevices</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/png.html" class="external-link">png</a></span><span class="op">(</span>filename <span class="op">=</span> <span class="va">temp</span>, width <span class="op">=</span> <span class="va">width</span>, height <span class="op">=</span> <span class="va">height</span>, <span class="va">...</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">img</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html" class="external-link">dev.off</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">sze</span> <span class="op">&lt;-</span> <span class="fu">fs</span><span class="fu">::</span><span class="fu"><a href="https://fs.r-lib.org/reference/file_info.html" class="external-link">file_info</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span><span class="op">$</span><span class="va">size</span></span>
<span>  <span class="va">raw</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readBin.html" class="external-link">readBin</a></span><span class="op">(</span><span class="va">temp</span>, n <span class="op">=</span> <span class="va">sze</span>, what <span class="op">=</span> <span class="st">"raw"</span><span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="../reference/summary_image.html">summary_image</a></span><span class="op">(</span></span>
<span>    <span class="va">raw</span>,</span>
<span>    width <span class="op">=</span> <span class="va">width</span>,</span>
<span>    height <span class="op">=</span> <span class="va">height</span>,</span>
<span>    colorspace <span class="op">=</span> <span class="fl">4</span>, <span class="co"># number of channels in the IMG. since PNG - 4</span></span>
<span>    metadata <span class="op">=</span> <span class="va">metadata</span>,</span>
<span>    tag <span class="op">=</span> <span class="va">tag</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>We can now save the raster image with:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">temp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempfile</a></span><span class="op">(</span><span class="st">"logdir"</span><span class="op">)</span> <span class="co"># use another logdir </span></span>
<span><span class="fu"><a href="../reference/get_default_logdir.html">set_default_logdir</a></span><span class="op">(</span><span class="va">temp</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="../reference/log_event.html">log_event</a></span><span class="op">(</span><span class="st">"Raster plot"</span> <span class="op">=</span> <span class="fu"><a href="../reference/summary_image.html">summary_image</a></span><span class="op">(</span><span class="va">img</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>It will be displayed in the dashboard:</p>
<pre><code><span><span class="co">#&gt; Started TensorBoard at http://127.0.0.1:6062</span></span></code></pre>
<p><img src="images_files/figure-html/raster-1.png" width="100%"></p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Daniel Falbel.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
